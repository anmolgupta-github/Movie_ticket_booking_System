<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Login | Movie Booking</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white flex items-center justify-center min-h-screen">
  <form id="loginForm" class="bg-gray-900 text-white p-8 rounded-xl shadow-lg max-w-md w-full mx-auto mt-16 space-y-6">
    <h2 class="text-3xl font-bold text-center mb-4">Sign In</h2>

    <input id="email" type="email" placeholder="Email"
      class="w-full px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg text-gray-200 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 outline-none" />

    <input id="password" type="password" placeholder="Password"
      class="w-full px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg text-gray-200 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 outline-none" />

    <p id="loginMessage" class="text-center text-sm font-semibold h-5"></p>

    <button id="loginBtn" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 rounded-lg shadow-md transition">
      Sign In
    </button>

    <p class="text-center text-gray-400 text-sm mt-3">
      Don‚Äôt have an account?
      <a href="register.html" class="text-blue-400 hover:text-blue-500">Register</a>
    </p>
  </form>

  <script>
  document.getElementById("loginBtn").addEventListener("click", async (e) => {
    e.preventDefault();

    const email = document.getElementById("email").value.trim();
    const password = document.getElementById("password").value.trim();
    const messageEl = document.getElementById("loginMessage");

    messageEl.textContent = "";
    messageEl.className = "text-center text-sm font-semibold h-5";

    if (!email || !password) {
      messageEl.textContent = "‚ö†Ô∏è Please fill in both fields.";
      messageEl.classList.add("text-yellow-400");
      return;
    }

    try {
      // ‚úÖ FIXED: Correct endpoint
      const response = await fetch("http://localhost:3000/auth/login", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ email, password }),
      });

      console.log("üîç Login response status:", response.status);

      const data = await response.json();
      console.log("üîç Login response data:", data);

      if (!response.ok) {
        messageEl.textContent = data.message || "‚ùå Invalid credentials.";
        messageEl.classList.add("text-red-400");
        return;
      }

      messageEl.textContent = "‚úÖ Login successful! Redirecting...";
      messageEl.classList.add("text-green-400");

      // Save JWT token
      localStorage.setItem("token", data.token);

      // Decode JWT
      const payload = JSON.parse(atob(data.token.split(".")[1]));
      console.log("üß† Decoded payload:", payload);

      // Redirect
      setTimeout(() => {
        if (payload.role && payload.role.toLowerCase() === "admin") {
          window.location.href = "admin.html";
        } else {
          window.location.href = "index.html";
        }
      }, 1000);

    } catch (error) {
      console.error("‚ùå Login error:", error);
      messageEl.textContent = "‚ö†Ô∏è Something went wrong. Please try again later.";
      messageEl.classList.add("text-red-400");
    }
  });
  </script>
</body>
</html>
